<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }
        .widget {
            width: 300px;
            height: 150px;

            display: flex;
            justify-content: space-between;

            border-radius: 30px;
            background-image: url(img/fon.jpg);
            
            padding: 20px;
        }

        .widget__card {
            text-align: center;

            width: 170px;
        }

        .widget__img {
            height: 135px;
            width: 150px;
        }

        .widget__text {
            color: #FFF;
        }

        .widget__text_padding {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .widget__suggest {
            display: inline-block;
        }

        .suggest__menu {
            position: absolute;
            padding: 8px 12px;

            max-height: 200px;
            max-width: 100px;
            overflow-y: scroll;

            border: 1px solid black;
            background-color: rgb(175, 233, 248);
        }

        .suggest__menu_hidden {
            display: none;
        }

        .suggest__menu-item {
            cursor: pointer;
            text-align: left;
        }

        .suggest__menu-item:hover {
            background-color: rgba(15, 131, 226, 0.884);
        }
        .suggest__input {
            width: 110px;
            color: #FFF;

            padding-left: 10px;

            background-color: transparent;
            border-radius: 10px;
        }

        .suggest__input::placeholder {
            margin-left: 10px;
            padding-right: 10px;
            color: #FFF;
        }

        .weather {
            margin-top: -20px;
        }

        .widget__btn {
            width: 90px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="widget">
        <div class="widget__card">
            <img class="widget__img" src="img/planet.png" alt="weather">
            <p class="widget__text weather"></p>
        </div>
        <div class="widget__card">
            <h1 class="widget__text widget__text_padding degree">ðŸŒ¡</h1>
            <div class="widget__suggest">
                <input class="suggest__input" type="text" placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð³Ð¾Ñ€Ð¾Ð´...">
                <div class="suggest__menu suggest__menu_hidden"></div>
            </div>
            <button class="widget__text_padding widget__btn">Your city</button>
        </div>
    </div>
    <script src="cities.js"></script>
    <script>
        /*Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ Ð²Ð¸Ð´Ð¶ÐµÑ‚ Ð¿Ð¾Ð³Ð¾Ð´Ñ‹, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð³Ð¾Ñ€Ð¾Ð´, Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð³Ð¾Ð´Ñƒ. 
        Ð“Ð¾Ñ€Ð¾Ð´ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ÑÑ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÑÐ°Ð´Ð¶ÐµÑÑ‚Ð° (Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°) Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² - Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ñ‚, 
        Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð´ÐµÐ»Ð°Ð»Ð¸ Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¼ Ð¸Ð· Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹.
        ÐŸÐ¾ÑÑ‚Ð°Ñ€Ð°Ð¹Ñ‚ÐµÑÑŒ Ð¾Ñ‚Ð½ÐµÑÑ‚Ð¸ÑÑŒ ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾ Ðº ÑÐ»Ð¾Ð²Ñƒ "ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹" - Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°ÐºÐ¾Ð¹-Ñ‚Ð¾ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð¸Ð´Ð¶ÐµÑ‚ Ð¸Ð· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°, Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹. 
        ÐšÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ - Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½Ð°Ð²Ð¾Ñ€Ð¾Ñ‡ÐµÐ½Ð½Ñ‹Ð¹, Ð½Ð¾ Ñ‚Ð°ÐºÐ¾Ð¹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ ÑÑ‚Ñ‹Ð´Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ Skyeng, Ð¯Ð½Ð´ÐµÐºÑ Ð¸Ð»Ð¸ Mail. 
        Ð”Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ API Openweathermap. Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð½Ð° Ð½ÐµÐ¼ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÐºÐ»ÑŽÑ‡.
        Ð’Ñ‹Ð²ÐµÐ´Ð¸Ñ‚Ðµ:
        - Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñƒ,
        - Ñ‚Ð¸Ð¿ Ð¿Ð¾Ð³Ð¾Ð´Ñ‹,
        - Ð¸ÐºÐ¾Ð½ÐºÑƒ Ñ‚Ð¸Ð¿Ð° Ð¿Ð¾Ð³Ð¾Ð´Ñ‹.
        ÐŸÐ¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐµÑ‰Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸.
        Ð£ÑÐ»Ð¾Ð¶Ð½ÐµÐ½Ð¸Ðµ (Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾): Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ð°.*/

        let lat = 0;
        let lng = 0;
        let suggestValue;
        let suggestShowMenu = false;
        let suggestCities = [];

        const suggest = document.querySelector('.widget__suggest');
        const suggestInput = suggest.querySelector('.suggest__input');
        const suggestMenu = suggest.querySelector('.suggest__menu');
        const widgetImg = document.querySelector('.widget__img')
        const weather = document.querySelector('.weather')
        const degree = document.querySelector('.degree');
        const data = document.querySelector('.data')

        window.onload = function(){
    
            suggestInput.value = "";
        };

        suggestInput.addEventListener('input', (event) => {
            const value = event.target.value;

            const searchValue = value.slice(0, 1).toUpperCase() + value.slice(1).toLowerCase();
           
            suggestShowMenu = true;
            suggestCities = cities.filter(
                city => city.name.startsWith(searchValue)
            );

            suggestMenu.innerHTML = '';

            suggestRedraw();
        });

        suggestMenu.addEventListener('click', (event) => {
            const menuItem = event.target;

            if (!menuItem.classList.contains('suggest__menu-item')) {
                return;
            }

            const city = menuItem.dataset.city;

            suggestInput.value = city;

            suggestShowMenu = false;
            suggestValue = city;

            suggestRedraw();

            cities.forEach(el => {
                if(el.name === city) {
                    lat = el.lat;
                    lng = el.lng;
                }
            });

            httpRequest({
                url: `https://api.openweathermap.org/data/2.5/weather?&lat=${lat}&lon=${lng}&units=metric&appid=${key}`,
                onSuccess: weatherShow,
                onFail: showError,
            }); 
        });

        function suggestRedraw() {
            if (!suggestShowMenu) {
                suggestMenu.classList.add('suggest__menu_hidden');

                return;
            }
            suggestMenu.classList.remove('suggest__menu_hidden');

            suggestInput.innerHTML = '';

            if (suggestCities.length) {
                suggestCities.forEach((city) => {
                    const suggestMenuItem = document.createElement('div');

                    suggestMenuItem.classList.add('suggest__menu-item');
                    suggestMenuItem.textContent = city.name;
                    suggestMenuItem.dataset.city = city.name;
                    suggestMenu.appendChild(suggestMenuItem);
                });
            } else {
                suggestMenu.appendChild(
                    document.createTextNode('ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾...')
                );
            }
        }


        const widgetBtn = document.querySelector('.widget__btn');

        widgetBtn.addEventListener('click', (event) => {
            let resultCityObj = [];
            let minDist = Infinity;

            navigator.geolocation.getCurrentPosition(function(data) {
                const { latitude, longitude } = data.coords;
                    
                for (let i = 0; i < window.cities.length; i++) { 

                    if (+latitude === +cities[i].lat && +longitude === +cities[i].lng) {
                        suggestInput.value = cities[i].name;
                        
                    } else {
                        let distanceLat = Math.abs(Number(latitude) - Number(window.cities[i].lat));
                        let distanceLng = Math.abs(Number(longitude) - Number(window.cities[i].lng));
                        let sumDistance = distanceLat + distanceLng;
                        
                        if (sumDistance < minDist) {
                            minDist = sumDistance;
                            resultCityObj = cities[i];
                        }
                    }
                }
            suggestInput.value = resultCityObj.name;
            lat = resultCityObj.lat;
            lng = resultCityObj.lng;

            httpRequest({
                url: `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${key}`,
                onSuccess: weatherShow,
                onFail: showError,
            });
        }
        )  
        });

        
        const key = '1c93b90b61f92c6a209e2012b287034c';
        
        function httpRequest({ url, method = 'GET', responseType = 'json', onSuccess, onFail }) {
            
            const request = new XMLHttpRequest();
            
            request.open(method, url);
            request.send();
            request.responseType = 'json';

            request.onload = function() {
                if (request.status === 200) {
                    onSuccess(request.response);
        
                } else {
                    onFail(request.response);
                }
            };

            request.onerror = function(e) {
                onFail(e.message);
            }      
        };

        function weatherShow(city) {
            weather.textContent = city.weather[0].main;
            degree.textContent = Math.floor(city.main.temp) + ' Â°C';
            widgetImg.setAttribute('src', `http://openweathermap.org/img/w/${city.weather[0].icon}.png`);
        }
        
        function showError(response) {
            degree.textContent = response || 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·';
        };
    </script>
</body>
</html>